(function(){var t,e,i,s={}.hasOwnProperty,n=function(t,e){function i(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};i=Math.sqrt,e=Math.floor,t=Math.abs,window.THREE||(window.THREE={}),THREE.terraingen||(THREE.terraingen={}),THREE.Vector3Buffer=function(t){function e(t){var e,i,s;for(this.length=t,this.bufStorage=new ArrayBuffer(3*this.length*4),this.buf=new Float32Array(this.bufStorage,0,3*this.length),e=i=0,s=this.length;s>i;e=i+=1)this[e]=new Float32Array(this.bufStorage,3*e*4,3)}return n(e,t),e.prototype.getBuffer=function(){return this.buf},e}(Array),THREE.terraingen.Point=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subSelf=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t}(),THREE.terraingen.AABB=function(){function t(t,e){var i;this.center=t,this.size=e,i=e/2,this.min=new THREE.terraingen.Point(t.x-i,t.y-i),this.max=new THREE.terraingen.Point(t.x+i,t.y+i)}return t.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y},t.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},t.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},t.prototype.intersects=function(t){return t instanceof THREE.terraingen.Point?this.containsPoint(t):!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},t}(),THREE.terraingen.QuadTreeBoundedItem=function(){function t(t,e){this.bounds=t,this.data=e}return t}(),THREE.terraingen.QuadTreePointItem=function(){function t(t,e){this.position=t,this.data=e}return t}(),THREE.terraingen.QuadTree=function(){function t(t){this.bounds=t,this.nw=null,this.ne=null,this.se=null,this.sw=null,this.items=[],this.isLeaf=!0}return t.prototype.max_items=4,t.prototype.addPointItem=function(t){var e,i,s,n;if(!this.bounds.containsPoint(t.position))return!1;if(this.isLeaf)this.items.push(t);else for(n=[this.nw,this.ne,this.se,this.sw],i=0,s=n.length;s>i;i++)if(e=n[i],e.bounds.containsPoint(t.position))return e.addPointItem(t),!0;return this.items.length>this.max_items&&this.split(),this},t.prototype.draw=function(t){var e,i,s,n,r;if(t.rect(this.bounds.min.x,this.bounds.min.y,this.bounds.max.x,this.bounds.max.y),!this.isLeaf){for(n=[this.nw,this.ne,this.se,this.sw],r=[],i=0,s=n.length;s>i;i++)e=n[i],r.push(e.draw(t));return r}},t.prototype.addItem=function(t){var e,i,s,n;if(!this.bounds.containsBox(t.bounds))return!1;if(this.isLeaf)this.items.push(t);else for(n=[this.nw,this.ne,this.se,this.sw],i=0,s=n.length;s>i;i++)e=n[i],e.bounds.intersects(t.bounds)&&e.addItem(t);return this.items.length>this.max_items&&this.split(),!0},t.prototype.query=function(t){var e,i,s,n,r;if(i=[],!this.bounds.intersects(t))return[];if(this.isLeaf)return this.items;for(r=[this.nw,this.ne,this.se,this.sw],s=0,n=r.length;n>s;s++)e=r[s],i=i.concat(e.query(t));return result},t.prototype.split=function(){var e,i,s,n,r,h,o,a,u,c,l;for(s=this.bounds.size/2,r=s/2,e=this.bounds.center,this.nw=new t(new THREE.terraingen.AABB(new THREE.terraingen.Point(e.x-r,e.y-r),s)),this.ne=new t(new THREE.terraingen.AABB(new THREE.terraingen.Point(e.x+r,e.y-r),s)),this.se=new t(new THREE.terraingen.AABB(new THREE.terraingen.Point(e.x+r,e.y+r),s)),this.sw=new t(new THREE.terraingen.AABB(new THREE.terraingen.Point(e.x-r,e.y+r),s));this.items.length;)if(n=this.items.pop(),n instanceof THREE.terraingen.QuadTreePointItem)for(c=[this.nw,this.ne,this.se,this.sw],h=0,a=c.length;a>h;h++)i=c[h],i.bounds.containsPoint(n.position)&&i.addPointItem(n);else for(l=[this.nw,this.ne,this.se,this.sw],o=0,u=l.length;u>o;o++)i=l[o],i.bounds.intersects(n.bounds)&&i.addItem(n);return this.isLeaf=!1},t}(),window.TerrainWorker={ready:!1,N:624,FF:4294967295,Seed:48932432,varianceTree:[],getDataArrays:function(t){var e;return this.maxVariance=t.variance,this.width=this.height=t.segments,e=Math.abs(t.bounds.max.x-t.bounds.min.x),this.squareUnits=e/t.segments,this.x=t.bounds.min.x,this.y=t.bounds.min.y,this.getVertices(t),this.getIndices(t),t},getIndices:function(t){var e;return e=this.buildTree(this.width,this.height,t),this.createIndexBuffer(t,e),t},createIndexBuffer:function(t,e){var i,s,n,r,h,o,a,u,c,l;for(n=new Uint16Array(6*this.indexCount),u=(t.segments-1)*this.squareUnits,i=(t.segments-1)*this.squareUnits,r=0,s=c=0,l=e.length;l>c;s=c+=1)null==e[s].lc&&(h=e[s].v1,o=e[s].v2,a=e[s].v3,n[r]=h,n[r+1]=o,n[r+2]=a,r+=3);return t.indices=n},getVertices:function(t){var e,i,s,n,r,h,o,a,u,c,l,f,d,m,x;for(a=t.bounds.min.x,u=t.bounds.min.y,o=e=t.segments,d=t.bounds.max.x-t.bounds.min.x,c=t.bounds.max.y-t.bounds.min.y,r=Math.abs(d/t.segments),h=Math.abs(c/t.segments),n=0,i=l=0;o>l;i=l+=1)for(m=a+i*r,s=f=0;e>f;s=f+=1)x=u+s*h,t.vertices.buf[n]=i*r,t.vertices.buf[n+1]=1200*this.getNoiseValue(m,x),t.vertices.buf[n+2]=s*h,n+=3;return t},getRegion:function(t){var e,i,s,n,r,h,o,a,u,c,l,f,d,m,x,y,b;for(this.initRandom(parseInt(t.seed)),this.initMap(),f=t.x,d=t.y,a=t.x,u=t.y,l=t.width,i=t.height,h=t.octaves,c=t.scale,o=t.container,r=0,s=m=0;l>m;s=m+=1)for(y=f+s,n=x=0;i>x;n=x+=1)b=d+n,o[r]=this.getNoiseValue(y,b,0,h,c),r++;return e={x:a,y:u},t},getNoiseValue:function(t,e,i,s,n){return null==i&&(i=0),null==s&&(s=8),null==n&&(n=1),this.noiseGenerator.get(t,e)},newTri:function(t,e,i){return{v1:t,v2:e,v3:i,ln:null,rn:null,bn:null,lc:null,rc:null}},getVariance:function(t,e,i,s){var n,r,h,o,a;return Math.abs(s.vertices[i][0]-s.vertices[t][0])>this.squareUnits||Math.abs(s.vertices[i][2]-s.vertices[t][2])>this.squareUnits?(r=Math.round((s.vertices[i][0]/this.squareUnits-s.vertices[t][0]/this.squareUnits)/2+s.vertices[t][0]/this.squareUnits),h=Math.round((s.vertices[i][2]/this.squareUnits-s.vertices[t][2]/this.squareUnits)/2+s.vertices[t][2]/this.squareUnits),a=Math.round(r*this.width+h),n=s.vertices[a][1],o=Math.abs(n-(s.vertices[t][1]+s.vertices[i][1])/2),o=Math.max(o,this.getVariance(e,a,t,s)),o=Math.max(o,this.getVariance(i,a,e,s))):o=0,o},buildTree:function(t,e,i){return this.tree=[],this.indexCount=0,this.tree.push(this.newTri(0,t-1,t+t*(e-1)-1)),this.tree.push(this.newTri(t-1+t*(e-1),t*(e-1),0)),this.tree[0].bn=1,this.tree[1].bn=0,this.buildFace(0,i),this.buildFace(1,i),this.tree},buildFace:function(t,e){var i,s,n;null!=this.tree[t].lc?(this.buildFace(this.tree[t].lc,e),this.buildFace(this.tree[t].rc,e)):(i=this.tree[t].v1,s=this.tree[t].v2,n=this.tree[t].v3,this.getVariance(i,s,n,e)>this.maxVariance?(this.splitFace(t,e),this.buildFace(this.tree[t].lc,e),this.buildFace(this.tree[t].rc,e)):this.indexCount++)},splitFace:function(t,e){null!=this.tree[t].bn?(this.tree[this.tree[t].bn].bn!==t&&this.splitFace(this.tree[t].bn,e),this.splitFace2(t,e),this.splitFace2(this.tree[t].bn,e),this.tree[this.tree[t].lc].rn=this.tree[this.tree[t].bn].rc,this.tree[this.tree[t].rc].ln=this.tree[this.tree[t].bn].lc,this.tree[this.tree[this.tree[t].bn].lc].rn=this.tree[t].rc,this.tree[this.tree[this.tree[t].bn].rc].ln=this.tree[t].lc):this.splitFace2(t,e)},getApexIndex:function(){},splitFace2:function(t,e){var i,s,n,r,h,o;n=this.tree[t].v1,r=this.tree[t].v2,h=this.tree[t].v3,i=(e.vertices[h][0]/this.squareUnits-e.vertices[n][0]/this.squareUnits)/2+e.vertices[n][0]/this.squareUnits,s=(e.vertices[h][2]/this.squareUnits-e.vertices[n][2]/this.squareUnits)/2+e.vertices[n][2]/this.squareUnits,o=Math.round(i*this.width+s),this.tree.push(this.newTri(r,o,n)),this.tree[t].lc=this.tree.length-1,this.tree.push(this.newTri(h,o,r)),this.tree[t].rc=this.tree.length-1,this.tree[this.tree[t].lc].ln=this.tree[t].rc,this.tree[this.tree[t].rc].rn=this.tree[t].lc,this.tree[this.tree[t].lc].bn=this.tree[t].ln,null!=this.tree[t].ln&&(this.tree[this.tree[t].ln].bn===t?this.tree[this.tree[t].ln].bn=this.tree[t].lc:this.tree[this.tree[t].ln].ln===t?this.tree[this.tree[t].ln].ln=this.tree[t].lc:this.tree[this.tree[t].ln].rn=this.tree[t].lc),this.tree[this.tree[t].rc].bn=this.tree[t].rn,null!=this.tree[t].rn&&(this.tree[this.tree[t].rn].bn===t?this.tree[this.tree[t].rn].bn=this.tree[t].rc:this.tree[this.tree[t].rn].rn===t?this.tree[this.tree[t].rn].rn=this.tree[t].rc:this.tree[this.tree[t].rn].ln=this.tree[t].rc)}}}).call(this);